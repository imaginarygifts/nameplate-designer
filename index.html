<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nameplate Designer</title>

<!-- Fabric JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<style>
@font-face {
  font-family: "Poppins";
  src: url("assets/fonts/Poppins-Regular.ttf");
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

#top {
  padding: 10px;
  text-align: center;
  background: #fff;
}

#canvasWrap {
  display: flex;
  justify-content: center;
  margin: 10px;
}

canvas {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,.2);
}

/* Bottom toolbar */
#toolbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #111;
  display: flex;
  overflow-x: auto;
}

#toolbar button {
  flex: 1;
  padding: 12px;
  color: #fff;
  background: none;
  border: none;
  font-size: 14px;
}

/* Popup */
.popup {
  display: none;
  position: fixed;
  bottom: 60px;
  left: 10px;
  right: 10px;
  background: #fff;
  padding: 10px;
  border-radius: 10px;
}

.popup button, .popup input {
  width: 100%;
  margin: 5px 0;
  padding: 8px;
}
</style>
</head>

<body>

<div id="top">
  <button onclick="exportJPG()">Save as JPG</button>
  <button onclick="deleteSelected()">Delete Selected</button>
</div>

<div id="canvasWrap">
  <canvas id="c" width="900" height="400"></canvas>
</div>

<!-- POPUPS -->
<div id="shapePopup" class="popup">
  <button onclick="addSVG('assets/shapes/rectangle.svg')">Rectangle</button>
  <button onclick="addSVG('assets/shapes/circle.svg')">Circle</button>
  <button onclick="addSVG('assets/shapes/square.svg')">square</button>
</div>

<div id="textPopup" class="popup">
  <input id="textValue" placeholder="Enter text">
  <button onclick="addText()">Add Text</button>
</div>

<div id="logoPopup" class="popup">
  <button onclick="addSVG('assets/logos/shivji.svg')">shivji</button>

</div>

<div id="bgPopup" class="popup">
  <button onclick="setBackground('assets/backgrounds/bg1.jpg')">Background 1</button>
  <button onclick="removeBackground()">Remove Background</button>
</div>

<div id="colorPopup" class="popup">
  <input type="color" onchange="changeColor(this.value)">
</div>

<!-- BOTTOM TOOLBAR -->
<div id="toolbar">
  <button onclick="toggle('shapePopup')">Shape</button>
  <button onclick="toggle('textPopup')">Text</button>
  <button onclick="toggle('logoPopup')">Logo</button>
  <button onclick="toggle('bgPopup')">Background</button>
  <button onclick="toggle('colorPopup')">Color</button>
</div>

<script>
const canvas = new fabric.Canvas('c', {
  preserveObjectStacking: true
});

function toggle(id) {
  document.querySelectorAll('.popup').forEach(p => p.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

/* Load font safely */
function loadFont(name) {
  return document.fonts.load(`20px ${name}`);
}

/* Add text */
async function addText() {
  const val = document.getElementById('textValue').value || 'Your Name';
  await loadFont("Coronet");

  const text = new fabric.Textbox(val, {
    left: 200,
    top: 150,
    fontFamily: 'Coronet',
    fontSize: 40,
    fill: '#000'
  });

  canvas.add(text);
  canvas.setActiveObject(text);
}

/* Add SVG (shape / logo / border) */
function addSVG(path) {
  fabric.loadSVGFromURL(path, (objects, options) => {
    const obj = fabric.util.groupSVGElements(objects, options);
    obj.set({
      left: 200,
      top: 100,
      scaleX: 0.5,
      scaleY: 0.5,
      fill: '#000'
    });
    canvas.add(obj);
    canvas.setActiveObject(obj);
  });
}

/* Change color */
function changeColor(color) {
  const obj = canvas.getActiveObject();
  if (!obj) return;

  if (obj.type === 'textbox') {
    obj.set('fill', color);
  } else {
    obj.getObjects().forEach(o => o.set('fill', color));
  }
  canvas.renderAll();
}

/* Background image */
function setBackground(path) {
  fabric.Image.fromURL(path, img => {
    img.scaleToWidth(canvas.width);
    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
  });
}

function removeBackground() {
  canvas.setBackgroundImage(null, canvas.renderAll.bind(canvas));
}

/* Delete */
function deleteSelected() {
  const obj = canvas.getActiveObject();
  if (obj) canvas.remove(obj);
}

/* Export JPG */
function exportJPG() {
  const link = document.createElement('a');
  link.download = 'nameplate.jpg';
  link.href = canvas.toDataURL({ format: 'jpeg', quality: 1 });
  link.click();
}
</script>

</body>
</html>
