<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nameplate Designer</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins&family=Great+Vibes&family=Playfair+Display&family=Cormorant&family=Dancing+Script&family=Montserrat&family=Cinzel&family=Libre+Baskerville&family=Lora&family=Abril+Fatface&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:Poppins,sans-serif;background:#f2f2f2;}
#controls{
  background:#fff;padding:10px;display:flex;gap:10px;
  justify-content:center;align-items:center;flex-wrap:wrap;
}
select,button{padding:6px 10px;font-size:14px;cursor:pointer;}
.icon-btn{font-size:18px;border:1px solid #ccc;border-radius:6px;background:#fff;}
#colorPanel{
  display:none;background:#fff;padding:8px;margin:5px auto;
  width:fit-content;border-radius:6px;
}
.color-swatch{
  width:24px;height:24px;border-radius:50%;
  display:inline-block;margin:4px;border:1px solid #aaa;
  cursor:pointer;
}
canvas{
  background:#fff;border:2px solid #333;
  display:block;margin:15px auto;
  touch-action:none;
}
</style>
</head>

<body>

<div id="controls">
  <select onchange="addShape(this.value)">
    <option value="">Choose Shape</option>
    <option value="rect">Rectangle</option>
    <option value="rounded">Rounded</option>
    <option value="pill">Pill</option>
    <option value="circle">Circle</option>
  </select>

  <select onchange="changeFont(this.value)">
    <option value="">Select Font</option>
    <option>Poppins</option>
    <option>Great Vibes</option>
    <option>Playfair Display</option>
    <option>Cormorant</option>
    <option>Dancing Script</option>
  </select>

  <button onclick="addText()">Add Text</button>
  <button class="icon-btn" onclick="undo()">âŸ²</button>
  <button class="icon-btn" onclick="redo()">âŸ³</button>
  <button id="colorBtn" onclick="toggleColorPanel()" style="display:none;">ðŸŽ¨ Color</button>
  <button onclick="exportJPG()">Save JPG</button>
</div>

<div id="colorPanel"></div>
<canvas id="canvas" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const colorPanel = document.getElementById("colorPanel");
const colorBtn = document.getElementById("colorBtn");

let objects=[], selected=null;
let action=null, sx=0, sy=0, startAngle=0;
let undoStack=[], redoStack=[];

const ICON_R=10, ICON_OFFSET=18;

const COLORS=["#000","#fff","#5a3a22","#f7f4e9","#d4af37","#c0c0c0","#b76e79","#f1c40f","#e74c3c","#3498db","#2ecc71"];

/* ---------- HELPERS ---------- */
function getPos(e){
  const r=canvas.getBoundingClientRect();
  const t=e.touches?e.touches[0]:e;
  return {x:(t.clientX-r.left)*(canvas.width/r.width),
          y:(t.clientY-r.top)*(canvas.height/r.height)};
}
function saveState(){undoStack.push(JSON.stringify(objects));redoStack=[];}
function undo(){if(!undoStack.length)return;redoStack.push(JSON.stringify(objects));objects=JSON.parse(undoStack.pop());selected=null;draw();}
function redo(){if(!redoStack.length)return;undoStack.push(JSON.stringify(objects));objects=JSON.parse(redoStack.pop());selected=null;draw();}
function dist(x1,y1,x2,y2){return Math.hypot(x1-x2,y1-y2);}

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  objects.forEach(o=>{
    ctx.save();
    ctx.translate(o.x+o.w/2,o.y+o.h/2);
    ctx.rotate(o.rotation);
    ctx.translate(-o.w/2,-o.h/2);

    ctx.fillStyle=o.color;
    if(o.type==="shape"){
      if(o.shape==="rect") ctx.fillRect(0,0,o.w,o.h);
      if(o.shape==="rounded"){
        ctx.beginPath();
        ctx.moveTo(20,0);ctx.lineTo(o.w-20,0);
        ctx.quadraticCurveTo(o.w,0,o.w,20);
        ctx.lineTo(o.w,o.h-20);
        ctx.quadraticCurveTo(o.w,o.h,o.w-20,o.h);
        ctx.lineTo(20,o.h);
        ctx.quadraticCurveTo(0,o.h,0,o.h-20);
        ctx.lineTo(0,20);
        ctx.quadraticCurveTo(0,0,20,0);
        ctx.fill();
      }
      if(o.shape==="pill"){
        ctx.beginPath();
        ctx.arc(o.h/2,o.h/2,o.h/2,Math.PI/2,Math.PI*1.5);
        ctx.arc(o.w-o.h/2,o.h/2,o.h/2,Math.PI*1.5,Math.PI/2);
        ctx.fill();
      }
      if(o.shape==="circle"){
        ctx.beginPath();
        ctx.arc(o.w/2,o.h/2,o.w/2,0,Math.PI*2);
        ctx.fill();
      }
    }

    if(o.type==="text"){
      ctx.font=`${o.fontSize}px ${o.font}`;
      ctx.textAlign="center";
      ctx.textBaseline="middle";
      ctx.fillText(o.text,o.w/2,o.h/2);
    }

    if(o===selected){
      ctx.strokeStyle="#1e90ff";
      ctx.setLineDash([6,4]);
      ctx.strokeRect(0,0,o.w,o.h);
      ctx.setLineDash([]);

      drawIcon(o,-ICON_OFFSET,-ICON_OFFSET,"delete");
      drawIcon(o,o.w+ICON_OFFSET,-ICON_OFFSET,"rotate");
      drawIcon(o,o.w+ICON_OFFSET,o.h+ICON_OFFSET,"resize");
    }

    ctx.restore();
  });
}

function drawIcon(o,x,y,type){
  ctx.beginPath();
  ctx.arc(x,y,ICON_R,0,Math.PI*2);
  ctx.fillStyle="#fff";ctx.fill();ctx.stroke();
  ctx.fillStyle="#333";
  if(type==="delete"){ctx.fillText("Ã—",x-4,y+4);}
  if(type==="rotate"){ctx.fillText("â†»",x-5,y+5);}
  if(type==="resize"){ctx.fillText("â†”",x-5,y+5);}
}

/* ---------- HIT ---------- */
function hit(x,y,o){
  if(dist(x,y,o.x-ICON_OFFSET,o.y-ICON_OFFSET)<ICON_R) return "delete";
  if(dist(x,y,o.x+o.w+ICON_OFFSET,o.y-ICON_OFFSET)<ICON_R) return "rotate";
  if(dist(x,y,o.x+o.w+ICON_OFFSET,o.y+o.h+ICON_OFFSET)<ICON_R) return "resize";
  if(x>o.x&&x<o.x+o.w&&y>o.y&&y<o.y+o.h) return "move";
  return null;
}

/* ---------- POINTER ---------- */
function down(e){
  e.preventDefault();
  const p=getPos(e);
  selected=null;action=null;
  for(let i=objects.length-1;i>=0;i--){
    const o=objects[i];
    const h=hit(p.x,p.y,o);
    if(h){
      selected=o;action=h;
      sx=p.x;sy=p.y;
      startAngle=Math.atan2(p.y-(o.y+o.h/2),p.x-(o.x+o.w/2))-o.rotation;
      if(h==="delete"){saveState();objects.splice(i,1);selected=null;}
      break;
    }
  }
  draw();
}
function move(e){
  if(!selected)return;
  e.preventDefault();
  const p=getPos(e);
  if(action==="move"){selected.x+=p.x-sx;selected.y+=p.y-sy;}
  if(action==="resize"){selected.w+=p.x-sx;selected.h+=p.y-sy;}
  if(action==="rotate"){selected.rotation=Math.atan2(p.y-(selected.y+selected.h/2),p.x-(selected.x+selected.w/2))-startAngle;}
  sx=p.x;sy=p.y;
  draw();
}
function up(){if(action)saveState();action=null;}

canvas.addEventListener("mousedown",down);
canvas.addEventListener("mousemove",move);
canvas.addEventListener("mouseup",up);
canvas.addEventListener("touchstart",down,{passive:false});
canvas.addEventListener("touchmove",move,{passive:false});
canvas.addEventListener("touchend",up);

/* ---------- ADD ---------- */
function addShape(s){
  if(!s)return;
  saveState();
  objects=objects.filter(o=>o.type!=="shape");
  objects.unshift({type:"shape",shape:s,x:250,y:130,w:300,h:140,color:"#000",rotation:0});
  selected=objects[0];draw();
}
function addText(){
  const t=prompt("Text","Your Name");
  if(!t)return;
  saveState();
  ctx.font="36px Poppins";
  const w=ctx.measureText(t).width+30;
  objects.push({type:"text",text:t,x:400-w/2,y:170,w,h:60,fontSize:36,font:"Poppins",color:"#000",rotation:0});
  selected=objects.at(-1);draw();
}

/* ---------- COLOR ---------- */
function toggleColorPanel(){
  colorPanel.innerHTML="";
  COLORS.forEach(c=>{
    const d=document.createElement("div");
    d.className="color-swatch";
    d.style.background=c;
    d.onclick=()=>{saveState();selected.color=c;colorPanel.style.display="none";draw();}
    colorPanel.appendChild(d);
  });
  colorPanel.style.display="block";
}

/* ---------- FONT ---------- */
function changeFont(f){
  if(selected&&selected.type==="text"){
    saveState();
    selected.font=f;
    ctx.font=`${selected.fontSize}px ${f}`;
    selected.w=ctx.measureText(selected.text).width+30;
    draw();
  }
}

function exportJPG(){
  const a=document.createElement("a");
  a.download="design.jpg";
  a.href=canvas.toDataURL("image/jpeg",1);
  a.click();
}

draw();
</script>
</body>
</html>
