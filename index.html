<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nameplate Designer</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

#canvasWrap {
  display: flex;
  justify-content: center;
  padding: 15px;
}

canvas {
  background: #fff;
  border: 1px solid #ccc;
}

#panel {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #111;
  color: #fff;
  padding: 10px;
}

.section {
  margin-bottom: 10px;
}

button, select, input[type=color] {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  border: none;
}

button {
  background: #fff;
  cursor: pointer;
}

.colors button {
  width: 23%;
  margin-right: 1%;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<div id="canvasWrap">
  <canvas id="c" width="600" height="350"></canvas>
</div>

<div id="panel">

  <!-- BACKGROUND IMAGE -->
  <div class="section">
    <b>Background Image</b>
    <button onclick="setBackground('assets/backgrounds/bg1.jpg')">Background 1</button>
    <button onclick="setBackground('assets/backgrounds/bg2.jpg')">Background 2</button>
    <button onclick="setBackground('assets/backgrounds/bg3.jpg')">Background 3</button>
    <button onclick="removeBackground()">Remove Background</button>
  </div>

  <!-- SHAPE -->
  <div class="section">
    <b>Choose Shape</b>
    <button onclick="setShape('assets/shapes/rectangle.svg')">Rectangle</button>
    <button onclick="setShape('assets/shapes/circle.svg')">Circle</button>
    <button onclick="setShape('assets/shapes/square.svg')">Square</button>
  </div>

  <!-- SHAPE COLOR -->
  <div class="section hidden" id="shapeColors">
    <b>Shape Color</b>
    <div class="colors">
      <button onclick="setShapeColor('#000')">Black</button>
      <button onclick="setShapeColor('#fff')">White</button>
      <button onclick="setShapeColor('#7b4a12')">Brown</button>
      <button onclick="setShapeColor('#c2a679')">Wood</button>
    </div>
  </div>

  <!-- TOOLS -->
  <div class="section hidden" id="tools">
    <b>Text</b>
    <button onclick="addText()">Add Text</button>
    <select onchange="changeFont(this.value)">
      <option value="">Select Font</option>
      <option value="Coronet">Coronet</option>
      <option value="Greshian_DEMO">Greshian_DEMO</option>
    </select>
    <input type="color" onchange="setTextColor(this.value)">

    <b>Logo / Border</b>
    <button onclick="addSVG('assets/logos/shivji.svg')">Add Logo</button>
    <button onclick="addSVG('assets/borders/1.svg')">Add Border</button>
    <input type="color" onchange="setSVGColor(this.value)">

    <b>Actions</b>
    <button onclick="deleteSelected()">Delete Selected</button>
    <button onclick="saveJPG()">Save as JPG</button>
  </div>

</div>

<script>
const canvas = new fabric.Canvas('c', {
  preserveObjectStacking: true
});

let baseShape = null;

/* LOAD FONTS */
['Poppins','Playfair'].forEach(fontName=>{
  const font = new FontFace(fontName, `url(assets/fonts/${fontName}.ttf)`);
  font.load().then(f => document.fonts.add(f));
});

/* BACKGROUND IMAGE */
function setBackground(path){
  fabric.Image.fromURL(path, img=>{
    img.scaleToWidth(canvas.width);
    img.scaleToHeight(canvas.height);
    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
  });
}

function removeBackground(){
  canvas.setBackgroundImage(null, canvas.renderAll.bind(canvas));
}

/* SET BASE SHAPE */
function setShape(path){
  if(baseShape) canvas.remove(baseShape);

  fabric.loadSVGFromURL(path, (objects, options)=>{
    baseShape = fabric.util.groupSVGElements(objects, options);
    baseShape.scaleToWidth(500);
    baseShape.left = 50;
    baseShape.top = 50;
    baseShape.selectable = false;
    baseShape.evented = false;

    canvas.add(baseShape);
    canvas.sendToBack(baseShape);
    canvas.renderAll();

    document.getElementById('shapeColors').classList.remove('hidden');
    document.getElementById('tools').classList.remove('hidden');
  });
}

/* SHAPE COLOR */
function setShapeColor(color){
  if(!baseShape) return;
  baseShape.getObjects().forEach(obj=>{
    if(obj.fill) obj.set('fill', color);
  });
  canvas.renderAll();
}

/* ADD TEXT */
function addText(){
  const text = new fabric.Textbox('Your Name', {
    left: 180,
    top: 150,
    fontSize: 32,
    fill: '#000'
  });
  canvas.add(text).setActiveObject(text);
}

/* FONT CHANGE */
function changeFont(font){
  const obj = canvas.getActiveObject();
  if(obj && obj.type==='textbox'){
    obj.set('fontFamily', font);
    canvas.renderAll();
  }
}

/* TEXT COLOR */
function setTextColor(color){
  const obj = canvas.getActiveObject();
  if(obj && obj.type==='textbox'){
    obj.set('fill', color);
    canvas.renderAll();
  }
}

/* ADD SVG */
function addSVG(path){
  fabric.loadSVGFromURL(path,(objects,options)=>{
    const el = fabric.util.groupSVGElements(objects,options);
    el.scaleToWidth(100);
    el.left = 250;
    el.top = 120;
    canvas.add(el).setActiveObject(el);
  });
}

/* SVG COLOR */
function setSVGColor(color){
  const obj = canvas.getActiveObject();
  if(obj && obj.type==='group'){
    obj.getObjects().forEach(o=>{
      if(o.fill) o.set('fill', color);
    });
    canvas.renderAll();
  }
}

/* DELETE */
function deleteSelected(){
  const obj = canvas.getActiveObject();
  if(obj && obj !== baseShape){
    canvas.remove(obj);
  }
}

/* SAVE JPG */
function saveJPG(){
  canvas.discardActiveObject();
  canvas.renderAll();
  const link = document.createElement('a');
  link.download = 'nameplate.jpg';
  link.href = canvas.toDataURL({format:'jpeg', quality:1});
  link.click();
}
</script>

</body>
</html>
