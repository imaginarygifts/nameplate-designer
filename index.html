<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nameplate Designer</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Poppins, sans-serif;
  background:#f2f2f2;
}
#controls{
  background:#fff;
  padding:10px;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}
select,button{
  padding:6px 10px;
  font-size:14px;
}
canvas{
  background:#fff;
  border:2px solid #333;
  display:block;
  margin:15px auto;
}
</style>
</head>

<body>

<div id="controls">
  <select onchange="addShape(this.value)">
    <option value="">Choose Shape</option>
    <option value="rect">Rectangle</option>
    <option value="rounded">Rounded</option>
    <option value="circle">Circle</option>
    <option value="arch">Arch</option>
  </select>

  <select onchange="changeFont(this.value)">
    <option value="">Select Font</option>
    <option value="Poppins">Poppins</option>
  </select>

  <button onclick="addText()">Add Text</button>
  <button onclick="exportJPG()">Save JPG</button>
</div>

<canvas id="canvas" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let objects=[], selected=null;
let action=null, startX=0, startY=0, startAngle=0;

const ICON_R = 14;
const ICON_OFFSET = 30;

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  objects.forEach(o=>{
    ctx.save();
    ctx.translate(o.x+o.w/2,o.y+o.h/2);
    ctx.rotate(o.rotation);
    ctx.translate(-o.w/2,-o.h/2);

    // Shapes
    if(o.type==="rect"){
      ctx.fillStyle=o.color;
      ctx.fillRect(0,0,o.w,o.h);
    }
    if(o.type==="rounded"){
      roundRect(0,0,o.w,o.h,20,o.color);
    }
    if(o.type==="circle"){
      ctx.fillStyle=o.color;
      ctx.beginPath();
      ctx.arc(o.w/2,o.h/2,o.w/2,0,Math.PI*2);
      ctx.fill();
    }
    if(o.type==="arch"){
      ctx.fillStyle=o.color;
      ctx.beginPath();
      ctx.moveTo(0,o.h);
      ctx.lineTo(0,o.h/2);
      ctx.arc(o.w/2,o.h/2,o.w/2,Math.PI,0);
      ctx.lineTo(o.w,o.h);
      ctx.closePath();
      ctx.fill();
    }

    // Text
    if(o.type==="text"){
      ctx.fillStyle=o.color;
      ctx.font=`${o.fontSize}px ${o.font}`;
      ctx.textAlign="center";
      ctx.textBaseline="middle";
      ctx.fillText(o.text,o.w/2,o.h/2);
    }

    if(o===selected) drawSelection(o);
    ctx.restore();
  });
}

function roundRect(x,y,w,h,r,color){
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.lineTo(x+w-r,y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);
  ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);
  ctx.quadraticCurveTo(x,y,x+r,y);
  ctx.fill();
}

/* ---------- SELECTION UI ---------- */
function drawSelection(o){
  ctx.strokeStyle="#1e90ff";
  ctx.setLineDash([6,4]);
  ctx.strokeRect(0,0,o.w,o.h);
  ctx.setLineDash([]);

  drawDeleteIcon(-ICON_OFFSET,-ICON_OFFSET);
  drawRotateIcon(o.w+ICON_OFFSET,-ICON_OFFSET);
  drawResizeIcon(o.w+ICON_OFFSET,o.h+ICON_OFFSET);
}

function drawDeleteIcon(x,y){
  ctx.beginPath();
  ctx.arc(x,y,ICON_R,0,Math.PI*2);
  ctx.fillStyle="#fff";
  ctx.fill();
  ctx.strokeStyle="#666";
  ctx.stroke();

  ctx.strokeStyle="#333";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(x-5,y-5);
  ctx.lineTo(x+5,y+5);
  ctx.moveTo(x+5,y-5);
  ctx.lineTo(x-5,y+5);
  ctx.stroke();
}

function drawRotateIcon(x,y){
  ctx.beginPath();
  ctx.arc(x,y,ICON_R,0,Math.PI*2);
  ctx.fillStyle="#fff";
  ctx.fill();
  ctx.strokeStyle="#666";
  ctx.stroke();

  ctx.strokeStyle="#333";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.arc(x,y,6,Math.PI*0.25,Math.PI*1.5);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(x+4,y-7);
  ctx.lineTo(x+9,y-7);
  ctx.lineTo(x+9,y-2);
  ctx.stroke();
}

function drawResizeIcon(x,y){
  ctx.beginPath();
  ctx.arc(x,y,ICON_R,0,Math.PI*2);
  ctx.fillStyle="#fff";
  ctx.fill();
  ctx.strokeStyle="#666";
  ctx.stroke();

  ctx.strokeStyle="#333";
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(x-6,y+6);
  ctx.lineTo(x+6,y-6);
  ctx.moveTo(x+2,y-6);
  ctx.lineTo(x+6,y-6);
  ctx.lineTo(x+6,y-2);
  ctx.stroke();
}

/* ---------- ADD SHAPE ---------- */
function addShape(type){
  if(!type) return;
  objects = objects.filter(o=>!o.isBaseShape);

  let shape={type,x:250,y:140,w:300,h:120,color:"#000",rotation:0,isBaseShape:true};
  if(type==="circle"){shape.w=150;shape.h=150;shape.x=325;}

  objects.unshift(shape);
  selected=shape;
  draw();
}

/* ---------- ADD TEXT ---------- */
function addText(){
  const t=prompt("Enter text","Your Name");
  if(!t) return;

  ctx.font="36px Poppins";
  const w=ctx.measureText(t).width+30;
  const h=36+20;

  const obj={type:"text",text:t,x:400-w/2,y:200-h/2,w,h,fontSize:36,font:"Poppins",color:"#fff",rotation:0};
  objects.push(obj);
  selected=obj;
  draw();
}

function changeFont(f){
  if(selected && selected.type==="text"){
    selected.font=f;
    ctx.font=`${selected.fontSize}px ${f}`;
    selected.w=ctx.measureText(selected.text).width+30;
    draw();
  }
}

/* ---------- HIT TEST ---------- */
function hit(mx,my,o){
  if(dist(mx,my,o.x-ICON_OFFSET,o.y-ICON_OFFSET)<ICON_R) return "delete";
  if(dist(mx,my,o.x+o.w+ICON_OFFSET,o.y-ICON_OFFSET)<ICON_R) return "rotate";
  if(dist(mx,my,o.x+o.w+ICON_OFFSET,o.y+o.h+ICON_OFFSET)<ICON_R) return "resize";
  if(mx>o.x && mx<o.x+o.w && my>o.y && my<o.y+o.h) return "move";
  return null;
}

function dist(x1,y1,x2,y2){
  return Math.hypot(x1-x2,y1-y2);
}

/* ---------- EVENTS ---------- */
canvas.addEventListener("mousedown",e=>{
  const mx=e.offsetX,my=e.offsetY;
  selected=null; action=null;

  for(let i=objects.length-1;i>=0;i--){
    const o=objects[i];
    const h=hit(mx,my,o);
    if(h){
      selected=o; action=h;
      startX=mx; startY=my;
      startAngle=Math.atan2(my-(o.y+o.h/2),mx-(o.x+o.w/2))-o.rotation;
      if(h==="delete"){objects=objects.filter(x=>x!==o);selected=null;}
      break;
    }
  }
  draw();
});

canvas.addEventListener("mousemove",e=>{
  if(!selected) return;
  const mx=e.offsetX,my=e.offsetY;

  if(action==="move"){
    selected.x+=mx-startX;
    selected.y+=my-startY;
    startX=mx; startY=my;
  }
  if(action==="resize"){
    selected.w+=mx-startX;
    selected.h+=my-startY;
    if(selected.type==="text"){
      selected.fontSize=Math.max(14,selected.h*0.6);
    }
    startX=mx; startY=my;
  }
  if(action==="rotate"){
    selected.rotation=Math.atan2(my-(selected.y+selected.h/2),mx-(selected.x+selected.w/2))-startAngle;
  }
  draw();
});

canvas.addEventListener("mouseup",()=>action=null);

canvas.addEventListener("dblclick",()=>{
  if(selected && selected.type==="text"){
    const t=prompt("Edit text",selected.text);
    if(t){
      selected.text=t;
      ctx.font=`${selected.fontSize}px ${selected.font}`;
      selected.w=ctx.measureText(t).width+30;
    }
    draw();
  }
});

function exportJPG(){
  const a=document.createElement("a");
  a.download="design.jpg";
  a.href=canvas.toDataURL("image/jpeg",1);
  a.click();
}

draw();
</script>

</body>
</html>
