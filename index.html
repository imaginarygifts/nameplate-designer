<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Imaginary Gifts â€“ Designer</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins&family=Great+Vibes&family=Dancing+Script&family=Playfair+Display&family=Montserrat&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">

<style>
body{margin:0;background:#000;font-family:Poppins}

/* BRAND */
#brand{
  text-align:center;
  padding:30px;
  font-size:60px;
  font-family:"Cinzel Decorative",serif;
  background:#000;
  background-image:linear-gradient(135deg,#7a5c00,#fff3b0,#7a5c00);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* CANVAS */
#canvas{
  background:#fff;
  border:2px solid #000;
  border-radius:18px;
  display:block;
  margin:10px auto;
  touch-action:none;
}

/* BUTTONS */
.big-btn{
  width:100%;
  padding:30px;
  font-size:24px;
  background:#000;
  color:#f7f4e9;
  border:2px solid #f7f4e9;
  border-radius:14px;
  margin:10px auto;
}
.mini-btn{
  padding:26px 30px;
  font-size:38px;
  background:#000;
  color:#fff;
  border:2px solid #fff;
  border-radius:18px;
}

.palette{
  display:none;
  overflow-x:auto;
  white-space:nowrap;
  padding:10px;
}
.thumb{
  width:60px;height:60px;
  border-radius:10px;
  margin-right:10px;
  display:inline-block;
  border:2px solid #fff;
}
.big-thumb{
  width:200px;height:200px;
  display:inline-flex;
  justify-content:center;
  align-items:center;
  background:#fff;
  border-radius:16px;
  border:2px solid #fff;
  margin-right:14px;
}
.big-thumb img{max-width:90%;max-height:90%}

#controls{
  display:grid;
  grid-template-columns:1fr auto;
  gap:14px;
  padding:14px;
}
.control-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  padding:14px;
}

button,select{
  padding:26px;
  font-size:20px;
  background:#000;
  color:#f7f4e9;
  border:2px solid #f7f4e9;
  border-radius:14px;
}
.right-tools{display:flex;gap:10px}
</style>
</head>

<body>

<div id="brand">Imaginary Gifts</div>
<canvas id="canvas"></canvas>

<button class="big-btn" onclick="toggleColors()">SELECT COLOUR</button>
<div id="colors" class="palette"></div>

<div id="controls">
<select onchange="addShape(this.value)">
  <option value="">Canvas Shape</option>
  <option value="rect">Rectangle</option>
  <option value="circle">Circle</option>
</select>
<div class="right-tools">
  <button class="mini-btn" onclick="undo()">â†¶</button>
  <button class="mini-btn" onclick="toggleLock()">ðŸ”’</button>
  <button class="mini-btn" onclick="redo()">â†·</button>
</div>
</div>

<div class="control-grid">
<button onclick="addText()">Add Text</button>
<select onchange="changeFont(this.value)">
  <option value="">Select Font</option>
  <option>Cinzel Decorative</option>
  <option>Great Vibes</option>
  <option>Dancing Script</option>
  <option>Playfair Display</option>
  <option>Montserrat</option>
</select>
</div>

<div class="control-grid">
<button onclick="toggleLogoPalette()">Add Logo</button>
<button onclick="toggleBorderPalette()">Add Border</button>
</div>

<div class="control-grid">
<button onclick="toggleSvgShapePalette()">Add SVG Shape</button>
<button onclick="toggleBgPalette()">Canvas Background</button>
</div>

<div id="logoPalette" class="palette"></div>
<div id="borderPalette" class="palette"></div>
<div id="svgShapePalette" class="palette"></div>
<div id="bgPalette" class="palette"></div>

<button class="big-btn" onclick="saveImage()">SAVE DESIGN</button>

<script>
/* ================= CORE ================= */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
canvas.width=Math.min(innerWidth-20,900);
canvas.height=700;

let objects=[],selected=null,mode=null;
let sx=0,sy=0,startAngle=0;
let history=[],redoStack=[];
let canvasBg="#fff",canvasBgImage=null;

/* ================= DATA ================= */
const COLORS=["#000","#fff","#5a3a22","#f7f4e9","#e74c3c","#3498db","#2ecc71","gold","silver","rosegold"];

const LOGOS=[
"https://upload.wikimedia.org/wikipedia/commons/6/6e/Om_symbol.svg",
"https://upload.wikimedia.org/wikipedia/commons/3/3b/Ganesha_outline.svg",
"https://upload.wikimedia.org/wikipedia/commons/8/8f/Buddha_outline.svg"
];
const BORDERS=[
"https://upload.wikimedia.org/wikipedia/commons/2/29/Decorative_border_1.svg"
];
const SVG_SHAPES=[
"https://upload.wikimedia.org/wikipedia/commons/8/84/Rectangle_example.svg",
"https://upload.wikimedia.org/wikipedia/commons/3/3f/Circle_-_black_simple.svg"
];
const BG_IMAGES=[
"https://images.unsplash.com/photo-1549640365-823a8e65f6b0",
"https://images.unsplash.com/photo-1523413651479-597eb2da0ad6"
];

/* ================= HISTORY ================= */
function saveState(){
  history.push(JSON.stringify({objects,canvasBg}));
  redoStack=[];
}
function undo(){
  if(!history.length)return;
  redoStack.push(JSON.stringify({objects,canvasBg}));
  const s=JSON.parse(history.pop());
  objects=s.objects;canvasBg=s.canvasBg;draw();
}
function redo(){
  if(!redoStack.length)return;
  history.push(JSON.stringify({objects,canvasBg}));
  const s=JSON.parse(redoStack.pop());
  objects=s.objects;canvasBg=s.canvasBg;draw();
}

/* ================= METALLIC ================= */
function metallic(type,w){
  const g=ctx.createLinearGradient(0,0,w,0);
  if(type==="gold"){g.addColorStop(0,"#7a5c00");g.addColorStop(.5,"#fff3b0");g.addColorStop(1,"#7a5c00");}
  if(type==="silver"){g.addColorStop(0,"#777");g.addColorStop(.5,"#fff");g.addColorStop(1,"#777");}
  if(type==="rosegold"){g.addColorStop(0,"#8b5a5a");g.addColorStop(.5,"#f3c1c1");g.addColorStop(1,"#8b5a5a");}
  return g;
}

/* ================= DRAW ================= */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(canvasBgImage) ctx.drawImage(canvasBgImage,0,0,canvas.width,canvas.height);
  else{ctx.fillStyle=canvasBg;ctx.fillRect(0,0,canvas.width,canvas.height);}

  objects.forEach(o=>{
    ctx.save();
    ctx.translate(o.x+o.w/2,o.y+o.h/2);
    ctx.rotate(o.rotation);
    ctx.translate(-o.w/2,-o.h/2);

    if(o.type==="shape"){
      ctx.fillStyle=COLORS.includes(o.color)?(o.color==="gold"||o.color==="silver"||o.color==="rosegold"?metallic(o.color,o.w):o.color):o.color;
      ctx.beginPath();
      o.shape==="circle"
        ? ctx.arc(o.w/2,o.h/2,o.w/2,0,Math.PI*2)
        : ctx.rect(0,0,o.w,o.h);
      ctx.fill();
    }

    if(o.type==="text"){
      ctx.font=`${o.size}px ${o.font}`;
      o.w=ctx.measureText(o.text).width;o.h=o.size;
      ctx.fillStyle=o.color==="gold"||o.color==="silver"||o.color==="rosegold"?metallic(o.color,o.w):o.color;
      ctx.fillText(o.text,0,0);
    }

    if(o.bitmap){
      ctx.drawImage(o.bitmap,0,0,o.w,o.h);
      ctx.globalCompositeOperation="source-atop";
      ctx.fillStyle=o.color==="gold"||o.color==="silver"||o.color==="rosegold"?metallic(o.color,o.w):o.color;
      ctx.fillRect(0,0,o.w,o.h);
      ctx.globalCompositeOperation="source-over";
    }

    ctx.restore();
  });
}

/* ================= LOAD SVG ================= */
async function loadSVG(url,type){
  saveState();
  const svg=await fetch(url).then(r=>r.text());
  const blob=new Blob([svg],{type:"image/svg+xml"});
  const bitmap=await createImageBitmap(blob);
  objects.push({
    type:type,
    bitmap:bitmap,
    x:200,y:200,
    w:300,h:300*(bitmap.height/bitmap.width),
    rotation:0,color:"gold",locked:false
  });
  draw();
}

/* ================= CONTROLS ================= */
function addText(){
  saveState();
  objects.push({type:"text",text:"Your Name",font:"Cinzel Decorative",size:80,x:200,y:300,rotation:0,color:"gold"});
  draw();
}
function changeFont(f){if(selected&&selected.type==="text"){saveState();selected.font=f;draw();}}
function toggleLock(){if(selected){saveState();selected.locked=!selected.locked;draw();}}

function toggleColors(){
  const p=document.getElementById("colors");
  p.innerHTML="";
  COLORS.forEach(c=>{
    const d=document.createElement("div");
    d.className="thumb";
    d.style.background=c==="gold"?"linear-gradient(135deg,#7a5c00,#fff3b0,#7a5c00)"
      :c==="silver"?"linear-gradient(135deg,#777,#fff,#777)"
      :c==="rosegold"?"linear-gradient(135deg,#8b5a5a,#f3c1c1,#8b5a5a)":c;
    d.onclick=()=>{saveState();selected.color=c;p.style.display="none";draw();}
    p.appendChild(d);
  });
  p.style.display="block";
}

/* ================= PALETTES ================= */
function toggleLogoPalette(){showPalette("logoPalette",LOGOS,"logo")}
function toggleBorderPalette(){showPalette("borderPalette",BORDERS,"border")}
function toggleSvgShapePalette(){showPalette("svgShapePalette",SVG_SHAPES,"svgShape")}
function toggleBgPalette(){
  const p=document.getElementById("bgPalette");p.innerHTML="";
  BG_IMAGES.forEach(u=>{
    const d=document.createElement("div");d.className="big-thumb";
    const i=document.createElement("img");i.src=u;d.appendChild(i);
    d.onclick=async()=>{
      const blob=await fetch(u).then(r=>r.blob());
      canvasBgImage=await createImageBitmap(blob);
      p.style.display="none";draw();
    };
    p.appendChild(d);
  });
  p.style.display="block";
}

function showPalette(id,arr,type){
  const p=document.getElementById(id);p.innerHTML="";
  arr.forEach(u=>{
    const d=document.createElement("div");d.className="big-thumb";
    const i=document.createElement("img");i.src=u;d.appendChild(i);
    d.onclick=()=>{loadSVG(u,type);p.style.display="none"};
    p.appendChild(d);
  });
  p.style.display="block";
}

/* ================= SAVE ================= */
function saveImage(){
  const a=document.createElement("a");
  a.href=canvas.toDataURL("image/jpeg",1);
  a.download="design.jpg";
  a.click();
}

draw();
</script>

</body>
</html>