<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nameplate Designer</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Poppins, sans-serif;
  background:#f2f2f2;
}

#controls{
  background:#fff;
  padding:10px;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}

#canvasWrap{
  display:flex;
  justify-content:center;
  margin:15px;
}

canvas{
  background:#fff;
  border:2px solid #333;
}
</style>
</head>

<body>

<div id="controls">
  <button onclick="addRect()">Add Shape</button>
  <button onclick="addText()">Add Text</button>
  <button onclick="rotateSelected()">Rotate</button>
  <button onclick="deleteSelected()">Delete</button>
  <button onclick="exportJPG()">Save JPG</button>
</div>

<div id="canvasWrap">
  <canvas id="canvas" width="800" height="400"></canvas>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let objects = [];
let selected = null;
let mode = null; // move | resize
let handle = null;
let offsetX = 0;
let offsetY = 0;

const HANDLE_SIZE = 8;

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  objects.forEach(o=>{
    ctx.save();

    ctx.translate(o.x + o.w/2, o.y + o.h/2);
    ctx.rotate(o.rotation);
    ctx.translate(-o.w/2, -o.h/2);

    // Draw object
    if(o.type === "rect"){
      ctx.fillStyle = o.color;
      ctx.fillRect(0,0,o.w,o.h);
    }

    if(o.type === "text"){
      ctx.fillStyle = o.color;
      ctx.font = `${o.size}px Poppins`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(o.text, o.w/2, o.h/2);
    }

    // Selection
    if(o === selected){
      ctx.strokeStyle = "#1e90ff";
      ctx.lineWidth = 2;
      ctx.setLineDash([6,4]);
      ctx.strokeRect(0,0,o.w,o.h);
      ctx.setLineDash([]);

      drawHandles(o);
    }

    ctx.restore();
  });
}

/* ---------- HANDLES ---------- */
function drawHandles(o){
  const points = [
    {x:0,y:0,name:"tl"},
    {x:o.w,y:0,name:"tr"},
    {x:0,y:o.h,name:"bl"},
    {x:o.w,y:o.h,name:"br"}
  ];

  ctx.fillStyle = "#1e90ff";
  points.forEach(p=>{
    ctx.fillRect(
      p.x - HANDLE_SIZE/2,
      p.y - HANDLE_SIZE/2,
      HANDLE_SIZE,
      HANDLE_SIZE
    );
  });
}

function getHandle(mx,my,o){
  const handles = [
    {x:o.x,y:o.y,name:"tl"},
    {x:o.x+o.w,y:o.y,name:"tr"},
    {x:o.x,y:o.y+o.h,name:"bl"},
    {x:o.x+o.w,y:o.y+o.h,name:"br"}
  ];
  for(let h of handles){
    if(
      mx > h.x-HANDLE_SIZE &&
      mx < h.x+HANDLE_SIZE &&
      my > h.y-HANDLE_SIZE &&
      my < h.y+HANDLE_SIZE
    ){
      return h.name;
    }
  }
  return null;
}

/* ---------- ADD OBJECTS ---------- */
function addRect(){
  objects.push({
    type:"rect",
    x:200,y:150,
    w:300,h:100,
    color:"#000",
    rotation:0
  });
  draw();
}

function addText(){
  const txt = prompt("Enter text","Your Name");
  if(!txt) return;

  objects.push({
    type:"text",
    text:txt,
    x:250,y:170,
    w:300,h:80,
    size:36,
    color:"#000",
    rotation:0
  });
  draw();
}

/* ---------- MOUSE EVENTS ---------- */
canvas.addEventListener("mousedown",(e)=>{
  const mx = e.offsetX;
  const my = e.offsetY;
  selected = null;
  mode = null;
  handle = null;

  for(let i = objects.length-1; i>=0; i--){
    const o = objects[i];
    const h = getHandle(mx,my,o);
    if(h){
      selected = o;
      mode = "resize";
      handle = h;
      break;
    }
    if(mx>o.x && mx<o.x+o.w && my>o.y && my<o.y+o.h){
      selected = o;
      mode = "move";
      offsetX = mx - o.x;
      offsetY = my - o.y;
      break;
    }
  }
  draw();
});

canvas.addEventListener("mousemove",(e)=>{
  if(!selected) return;

  const mx = e.offsetX;
  const my = e.offsetY;

  if(mode === "move"){
    selected.x = mx - offsetX;
    selected.y = my - offsetY;
  }

  if(mode === "resize"){
    if(handle === "br"){
      selected.w = mx - selected.x;
      selected.h = my - selected.y;
    }
    if(handle === "tr"){
      selected.w = mx - selected.x;
      selected.h += selected.y - my;
      selected.y = my;
    }
    if(handle === "bl"){
      selected.w += selected.x - mx;
      selected.x = mx;
      selected.h = my - selected.y;
    }
    if(handle === "tl"){
      selected.w += selected.x - mx;
      selected.h += selected.y - my;
      selected.x = mx;
      selected.y = my;
    }
  }
  draw();
});

canvas.addEventListener("mouseup",()=>{
  mode = null;
  handle = null;
});

/* ---------- ACTIONS ---------- */
function rotateSelected(){
  if(selected){
    selected.rotation += Math.PI/12;
    draw();
  }
}

function deleteSelected(){
  if(!selected) return;
  objects = objects.filter(o=>o!==selected);
  selected = null;
  draw();
}

function exportJPG(){
  const link=document.createElement("a");
  link.download="design.jpg";
  link.href=canvas.toDataURL("image/jpeg",1);
  link.click();
}

/* Init */
draw();
</script>

</body>
</html>
