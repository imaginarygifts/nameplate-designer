<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nameplate Designer</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Great+Vibes&family=Playfair+Display:wght@500;700&family=Cormorant:wght@400;600&family=Dancing+Script:wght@500;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Poppins, sans-serif;
  background:#f2f2f2;
}

#controls{
  background:#fff;
  padding:10px;
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}

select, button{
  padding:6px 10px;
  font-size:14px;
}

#canvasWrap{
  display:flex;
  justify-content:center;
  margin:15px;
}

canvas{
  background:#fff;
  border:2px solid #333;
}
</style>
</head>

<body>

<div id="controls">
  <!-- Shape Dropdown -->
  <select onchange="addShape(this.value)">
    <option value="">Add Shape</option>
    <option value="rect">Rectangle</option>
    <option value="rounded">Rounded Rectangle</option>
    <option value="circle">Circle</option>
    <option value="arch">Arch</option>
  </select>

  <!-- Font Dropdown -->
  <select onchange="changeFont(this.value)">
    <option value="">Select Font</option>
    <option value="Poppins">Poppins</option>
    <option value="Great Vibes">Great Vibes</option>
    <option value="Playfair Display">Playfair Display</option>
    <option value="Cormorant">Cormorant</option>
    <option value="Dancing Script">Dancing Script</option>
  </select>

  <button onclick="addText()">Add Text</button>
  <button onclick="rotateSelected()">Rotate</button>
  <button onclick="deleteSelected()">Delete</button>
  <button onclick="exportJPG()">Save JPG</button>
</div>

<div id="canvasWrap">
  <canvas id="canvas" width="800" height="400"></canvas>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let objects = [];
let selected = null;
let mode = null;
let handle = null;
let offsetX = 0;
let offsetY = 0;

const HANDLE = 8;

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  objects.forEach(o=>{
    ctx.save();
    ctx.translate(o.x + o.w/2, o.y + o.h/2);
    ctx.rotate(o.rotation);
    ctx.translate(-o.w/2, -o.h/2);

    // SHAPES
    if(o.type === "rect"){
      ctx.fillStyle = o.color;
      ctx.fillRect(0,0,o.w,o.h);
    }

    if(o.type === "rounded"){
      roundRect(0,0,o.w,o.h,20,o.color);
    }

    if(o.type === "circle"){
      ctx.fillStyle = o.color;
      ctx.beginPath();
      ctx.arc(o.w/2,o.h/2,o.w/2,0,Math.PI*2);
      ctx.fill();
    }

    if(o.type === "arch"){
      ctx.fillStyle = o.color;
      ctx.beginPath();
      ctx.moveTo(0,o.h);
      ctx.lineTo(0,o.h/2);
      ctx.arc(o.w/2,o.h/2,o.w/2,Math.PI,0);
      ctx.lineTo(o.w,o.h);
      ctx.closePath();
      ctx.fill();
    }

    // TEXT
    if(o.type === "text"){
      ctx.fillStyle = o.color;
      ctx.font = `${o.fontSize}px ${o.font}`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(o.text,o.w/2,o.h/2);
    }

    // SELECTION
    if(o === selected){
      ctx.strokeStyle="#1e90ff";
      ctx.setLineDash([6,4]);
      ctx.strokeRect(0,0,o.w,o.h);
      ctx.setLineDash([]);
      drawHandles(o);
    }

    ctx.restore();
  });
}

/* ---------- HELPERS ---------- */
function roundRect(x,y,w,h,r,color){
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.lineTo(x+w-r,y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);
  ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);
  ctx.quadraticCurveTo(x,y,x+r,y);
  ctx.fill();
}

function drawHandles(o){
  const pts=[
    {x:0,y:0},{x:o.w,y:0},
    {x:0,y:o.h},{x:o.w,y:o.h}
  ];
  ctx.fillStyle="#1e90ff";
  pts.forEach(p=>{
    ctx.fillRect(p.x-HANDLE/2,p.y-HANDLE/2,HANDLE,HANDLE);
  });
}

function hitHandle(mx,my,o){
  const h=[
    {x:o.x,y:o.y,n:"tl"},
    {x:o.x+o.w,y:o.y,n:"tr"},
    {x:o.x,y:o.y+o.h,n:"bl"},
    {x:o.x+o.w,y:o.y+o.h,n:"br"}
  ];
  for(let p of h){
    if(mx>p.x-HANDLE && mx<p.x+HANDLE && my>p.y-HANDLE && my<p.y+HANDLE){
      return p.n;
    }
  }
  return null;
}

/* ---------- ADD SHAPE ---------- */
function addShape(type){
  if(!type) return;

  if(type === "circle"){
    objects.push({type,x:300,y:130,w:140,h:140,color:"#000",rotation:0});
  }else{
    objects.push({type,x:250,y:150,w:300,h:120,color:"#000",rotation:0});
  }
  draw();
}

/* ---------- ADD TEXT ---------- */
function addText(){
  const t = prompt("Enter text","Your Name");
  if(!t) return;

  objects.push({
    type:"text",
    text:t,
    x:270,y:160,
    w:260,h:80,
    fontSize:36,
    font:"Poppins",
    color:"#fff",
    rotation:0
  });
  draw();
}

/* ---------- FONT CHANGE ---------- */
function changeFont(font){
  if(selected && selected.type==="text"){
    selected.font = font;
    draw();
  }
}

/* ---------- MOUSE ---------- */
canvas.addEventListener("mousedown",e=>{
  const mx=e.offsetX,my=e.offsetY;
  selected=null; mode=null;

  for(let i=objects.length-1;i>=0;i--){
    const o=objects[i];
    const h=hitHandle(mx,my,o);
    if(h){ selected=o; mode="resize"; handle=h; break; }
    if(mx>o.x && mx<o.x+o.w && my>o.y && my<o.y+o.h){
      selected=o; mode="move";
      offsetX=mx-o.x; offsetY=my-o.y;
      break;
    }
  }
  draw();
});

canvas.addEventListener("mousemove",e=>{
  if(!selected) return;
  const mx=e.offsetX,my=e.offsetY;

  if(mode==="move"){
    selected.x=mx-offsetX;
    selected.y=my-offsetY;
  }

  if(mode==="resize"){
    if(handle==="br"){ selected.w=mx-selected.x; selected.h=my-selected.y; }
    if(handle==="tr"){ selected.w=mx-selected.x; selected.h+=selected.y-my; selected.y=my; }
    if(handle==="bl"){ selected.w+=selected.x-mx; selected.x=mx; selected.h=my-selected.y; }
    if(handle==="tl"){
      selected.w+=selected.x-mx;
      selected.h+=selected.y-my;
      selected.x=mx; selected.y=my;
    }

    // ðŸ”¥ KEY FIX: resize text font with box
    if(selected.type==="text"){
      selected.fontSize = Math.max(12, selected.h * 0.6);
    }
  }
  draw();
});

canvas.addEventListener("mouseup",()=>{ mode=null; handle=null; });

/* ---------- ACTIONS ---------- */
function rotateSelected(){
  if(selected){ selected.rotation+=Math.PI/12; draw(); }
}

function deleteSelected(){
  if(!selected) return;
  objects=objects.filter(o=>o!==selected);
  selected=null;
  draw();
}

function exportJPG(){
  const a=document.createElement("a");
  a.download="design.jpg";
  a.href=canvas.toDataURL("image/jpeg",1);
  a.click();
}

/* INIT */
draw();
</script>

</body>
</html>
