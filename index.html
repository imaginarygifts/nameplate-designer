<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Imaginary Gifts â€“ Designer</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins&family=Great+Vibes&family=Dancing+Script&family=Playfair+Display&family=Montserrat&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">

<style>
body{margin:0;background:#000;font-family:Poppins}

/* LOGO */
#brand{
  background:#000;
  text-align:center;
  padding:30px;
  font-size:60px;
  font-family:"Cinzel Decorative",serif;
  background-image:linear-gradient(135deg,#7a5c00,#fff3b0,#7a5c00);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* CANVAS */
#canvas{
  background:#fff;
  border:2px solid #000;
  border-radius:18px;
  display:block;
  margin:10px auto;
  touch-action:none;
}

/* BUTTONS */
.big-btn{
  width:100%;
  margin:10px auto;
  padding:36px;
  font-size:26px;
  background:#000;
  color:#f7f4e9;
  border:2px solid #f7f4e9;
  border-radius:14px;
  display:none;
}
.small-btn{
  display:block;
  margin:10px auto;
  padding:12px 24px;
  font-size:14px;
  background:#000;
  color:#fff;
  border:1px solid #fff;
  border-radius:10px;
}

/* MINI TOOLS */
.right-tools{display:flex;gap:10px}
.mini-btn{
  padding:14px 16px;
  font-size:50px;
  background:#000;
  color:#fff;
  border:2px solid #fff;
  border-radius:12px;
}

/* PALETTE */
.palette{
  display:none;
  overflow-x:auto;
  white-space:nowrap;
  padding:10px;
  text-align:center;
}
.thumb{
  width:50px;height:50px;
  display:inline-block;
  border-radius:8px;
  margin-right:10px;
  border:2px solid #fff;
}

/* CONTROLS */
#controls{
  background:#000;
  padding:18px;
  display:grid;
  grid-template-columns:1fr auto;
  gap:18px;
  align-items:center;
}
.control-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;
  margin-top:18px;
}
button,select{
  padding:30px;
  font-size:22px;
  background:#000;
  color:#f7f4e9;
  border:2px solid #f7f4e9;
  border-radius:14px;
}
</style>
</head>

<body>

<div id="brand">Imaginary Gifts</div>
<canvas id="canvas"></canvas>

<div id="canvasPalette" class="palette"></div>
<button class="small-btn" onclick="toggleCanvasPalette()">Canvas Colour</button>

<div id="colors" class="palette"></div>
<button id="colorBtn" class="big-btn" onclick="toggleColors()">SELECT COLOUR</button>

<div id="controls">
  <select onchange="addShape(this.value)">
    <option value="">Select Shape</option>
    <option value="rect">Rectangle</option>
    <option value="rounded">Rounded</option>
    <option value="circle">Circle</option>
    <option value="oval">Oval</option>
    <option value="pill">Pill</option>
    <option value="design6">Design 6</option>
    <option value="design7">Design 7</option>
    <option value="design8">Design 8</option>
    <option value="design9">Design 9</option>
    <option value="design10">Design 10</option>
  </select>

  <div class="right-tools">
    <button class="mini-btn" onclick="undo()">â†¶</button>
    <button class="mini-btn" onclick="toggleLock()">ðŸ”’</button>
    <button class="mini-btn" onclick="redo()">â†·</button>
  </div>
</div>

<div class="control-grid">
  <button onclick="addText()">Add Text</button>
  <select onchange="changeFont(this.value)">
    <option value="">Select Font</option>
    <option>Cinzel Decorative</option>
    <option>Great Vibes</option>
    <option>Dancing Script</option>
    <option>Playfair Display</option>
    <option>Montserrat</option>
  </select>
</div>

<button class="big-btn" style="display:block" onclick="saveImage()">SAVE DESIGN</button>

<script>
/* ---------- CORE ---------- */
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

let canvasBg="#fff";
let objects=[],selected=null;
let mode=null,sx=0,sy=0,startAngle=0,lastTapTime=0;

/* ---------- HISTORY ---------- */
let history=[],redoStack=[];
function saveState(){
  history.push(JSON.stringify({objects,canvasBg}));
  if(history.length>50) history.shift();
  redoStack=[];
}
function undo(){
  if(!history.length) return;
  redoStack.push(JSON.stringify({objects,canvasBg}));
  const s=JSON.parse(history.pop());
  objects=s.objects;canvasBg=s.canvasBg;selected=null;draw();
}
function redo(){
  if(!redoStack.length) return;
  history.push(JSON.stringify({objects,canvasBg}));
  const s=JSON.parse(redoStack.pop());
  objects=s.objects;canvasBg=s.canvasBg;selected=null;draw();
}

/* ---------- CONSTANTS ---------- */
const ELEMENT_COLORS=["#000","#fff","#5a3a22","#f7f4e9","#e74c3c","#3498db","#2ecc71","gold","silver","rosegold"];
const CANVAS_BACKGROUNDS=["#ffffff","#000000","#cccccc","#5a3a22"];

/* ---------- SVG STYLE SHAPES (PATHS) ---------- */
const SVG_SHAPES={
  design6:"M13851 12741c69,69 192,135 285,17 182,-232 -472,-613 -477,-1504 -3,-547 0,-1096 0,-1643 0,-289 -15,-470 -158,-670 -100,-138 -275,-280 -506,-326 -304,-60 -1431,24 -1612,-30 -33,-120 -13,-648 -13,-817 0,-284 -37,-533 217,-614 152,-48 1266,17 1613,-31 704,-96 1030,-564 1486,-1003 70,-67 124,-202 13,-286 -236,-180 -612,471 -1502,475 -548,3 -1096,0 -1644,0 -272,0 -489,18 -671,157 -136,105 -278,274 -325,508 -43,215 19,1549 -37,1605 -39,38 -701,19 -810,19 -284,0 -536,38 -614,-217 -48,-156 16,-1261 -30,-1612 -90,-673 -562,-1048 -1004,-1486 -65,-65 -191,-135 -286,-13 -183,234 471,606 475,1502 3,547 0,1096 0,1643 0,286 14,474 159,669 105,141 272,281 506,327 315,62 1408,-27 1612,30 32,121 13,645 13,817 0,733 -62,629 -1030,629 -811,0 -1249,-53 -1869,606 -141,150 -278,271 -414,417 -73,78 -132,192 -16,282 229,178 619,-474 1502,-475 548,-1 1096,0 1644,0 298,0 463,-13 670,-158 141,-99 277,-276 324,-504 58,-282 -25,-1483 35,-1607 91,-48 663,-20 813,-20 284,0 536,-37 615,217 49,157 -19,1264 30,1613 97,692 556,1034 1006,1483zm-2143 -2549c59,480 809,409 753,-94 -55,-495 -815,-409 -753,94zm-2257 0c22,188 200,352 421,326 193,-22 355,-199 331,-420 -54,-490 -812,-415 -752,94zm2568 -2679c-505,98 -347,838 136,744 187,-37 345,-219 302,-445 -36,-185 -220,-341 -438,-299zm-2258 0c-505,97 -348,837 136,744 186,-36 344,-220 302,-445 -35,-185 -220,-341 -438,-299z",
  design7:"M100 10 L190 60 L100 110 L10 60 Z",
  design8:"M100 10 A90 50 0 1 1 99 10",
  design9:"M10 10 H190 V110 H10 Z M30 30 H170 V90 H30 Z",
  design10:"M100 10 C150 10 190 60 100 110 C10 60 50 10 100 10 Z"
};

/* ---------- CANVAS SIZE ---------- */
function resizeCanvas(){
  canvas.width=Math.min(innerWidth-20,900);
  canvas.height=700;
  draw();
}
addEventListener("resize",resizeCanvas);

/* ---------- METALLIC ---------- */
function metallic(type,w){
  const g=ctx.createLinearGradient(0,0,w,0);
  if(type==="gold"){g.addColorStop(0,"#7a5c00");g.addColorStop(.5,"#fff3b0");g.addColorStop(1,"#7a5c00");}
  if(type==="silver"){g.addColorStop(0,"#777");g.addColorStop(.5,"#fff");g.addColorStop(1,"#777");}
  if(type==="rosegold"){g.addColorStop(0,"#8b5a5a");g.addColorStop(.5,"#f3c1c1");g.addColorStop(1,"#8b5a5a");}
  return g;
}

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle=canvasBg;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  objects.forEach(o=>{
    ctx.save();
    ctx.translate(o.x+o.w/2,o.y+o.h/2);
    ctx.rotate(o.rotation);
    ctx.translate(-o.w/2,-o.h/2);

    if(o.type==="shape"){
      ctx.fillStyle=["gold","silver","rosegold"].includes(o.color)?metallic(o.color,o.w):o.color;
      drawShape(o);
    }

    if(o.type==="text"){
      ctx.font=`${o.size}px ${o.font}`;
      ctx.textBaseline="top";
      o.w=ctx.measureText(o.text).width;
      o.h=o.size;
      ctx.fillStyle=["gold","silver","rosegold"].includes(o.color)?metallic(o.color,o.w):o.color;
      ctx.fillText(o.text,0,0);
    }

    if(o===selected) drawHandles(o);
    ctx.restore();
  });
}

/* ---------- SHAPES ---------- */
function drawShape(o){
  ctx.beginPath();

  if(o.shape==="rect") ctx.rect(0,0,o.w,o.h);
  else if(o.shape==="rounded") roundRect(0,0,o.w,o.h,20);
  else if(o.shape==="circle") ctx.arc(o.w/2,o.h/2,o.w/2,0,Math.PI*2);
  else if(o.shape==="oval") ctx.ellipse(o.w/2,o.h/2,o.w/2,o.h/2,0,0,Math.PI*2);
  else if(o.shape==="pill") roundRect(0,0,o.w,o.h,o.h/2);
  else if(SVG_SHAPES[o.shape]){
    const path=new Path2D(SVG_SHAPES[o.shape]);
    ctx.save();
    ctx.scale(o.w/40000,o.h/40000);
    ctx.fill(path);
    ctx.restore();
  }

  ctx.fill();
}
function roundRect(x,y,w,h,r){
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
}

/* ---------- HANDLES ---------- */
function drawIcon(x,y,t){
  ctx.beginPath();
  ctx.arc(x,y,14,0,Math.PI*2);
  ctx.fillStyle="#fff";ctx.fill();ctx.stroke();
  ctx.fillStyle="#000";ctx.font="16px Poppins";
  ctx.fillText(t,x-6,y+6);
}
function drawHandles(o){
  ctx.strokeStyle=o.locked?"#999":"#1e90ff";
  ctx.strokeRect(0,0,o.w,o.h);
  if(o.locked){drawIcon(o.w/2,-22,"ðŸ”’");return;}
  drawIcon(-18,-18,"Ã—");
  drawIcon(o.w+18,-18,"â†»");
  drawIcon(o.w+18,o.h+18,"â†”");
}

/* ---------- INTERACTION ---------- */
function getPos(e){
  const r=canvas.getBoundingClientRect();
  const t=e.touches?e.touches[0]:e;
  return{x:(t.clientX-r.left)*(canvas.width/r.width),y:(t.clientY-r.top)*(canvas.height/r.height)};
}

canvas.onmousedown=canvas.ontouchstart=e=>{
  saveState();e.preventDefault();
  const p=getPos(e);
  selected=null;mode=null;

  for(let i=objects.length-1;i>=0;i--){
    const o=objects[i];
    const cx=o.x+o.w/2,cy=o.y+o.h/2;
    const dx=p.x-cx,dy=p.y-cy;
    const cos=Math.cos(-o.rotation),sin=Math.sin(-o.rotation);
    const rx=cos*dx-sin*dy+o.w/2;
    const ry=sin*dx+cos*dy+o.h/2;

    if(!o.locked&&Math.hypot(rx+18,ry+18)<14){objects.splice(i,1);draw();return;}
    if(!o.locked&&Math.hypot(rx-(o.w+18),ry+18)<14){selected=o;mode="rotate";startAngle=Math.atan2(p.y-cy,p.x-cx)-o.rotation;break;}
    if(!o.locked&&Math.hypot(rx-(o.w+18),ry-(o.h+18))<14){selected=o;mode="resize";sx=p.x;sy=p.y;break;}
    if(rx>0&&rx<o.w&&ry>0&&ry<o.h){selected=o;if(!o.locked){mode="move";sx=p.x;sy=p.y;}break;}
  }

  colorBtn.style.display=selected?"block":"none";
  draw();
};

canvas.onmousemove=canvas.ontouchmove=e=>{
  if(!selected||!mode||selected.locked)return;
  e.preventDefault();
  const p=getPos(e);

  if(mode==="move"){selected.x+=p.x-sx;selected.y+=p.y-sy;}
  if(mode==="resize"){
    selected.w+=p.x-sx;
    selected.h+=p.y-sy;
    if(selected.type==="text") selected.size+=(p.y-sy)*0.5;
  }
  if(mode==="rotate"){
    const cx=selected.x+selected.w/2,cy=selected.y+selected.h/2;
    selected.rotation=Math.atan2(p.y-cy,p.x-cx)-startAngle;
  }

  sx=p.x;sy=p.y;draw();
};

canvas.onmouseup=canvas.ontouchend=()=>mode=null;

/* ---------- CONTROLS ---------- */
function addShape(s){
  saveState();
  if(!s)return;
  objects=objects.filter(o=>o.type!=="shape");
  const w=canvas.width*0.6;
  selected={type:"shape",shape:s,x:(canvas.width-w)/2,y:(canvas.height-w*0.6)/2,w:w,h:w*0.6,rotation:0,color:"#000",locked:false};
  objects.push(selected);
  colorBtn.style.display="block";
  draw();
}
function addText(){
  saveState();
  const t=prompt("Text","Your Name");
  if(!t)return;
  selected={type:"text",text:t,font:"Cinzel Decorative",size:canvas.width*0.08,x:canvas.width*0.2,y:canvas.height*0.45,rotation:0,color:"gold",locked:false};
  objects.push(selected);
  colorBtn.style.display="block";
  draw();
}
function changeFont(f){saveState();if(selected&&selected.type==="text"){selected.font=f;draw();}}
function toggleLock(){saveState();if(selected){selected.locked=!selected.locked;draw();}}

function toggleColors(){
  const c=document.getElementById("colors");
  c.innerHTML="";
  ELEMENT_COLORS.forEach(col=>{
    const d=document.createElement("div");
    d.className="thumb";
    if(col==="gold")d.style.background="linear-gradient(135deg,#7a5c00,#fff3b0,#7a5c00)";
    else if(col==="silver")d.style.background="linear-gradient(135deg,#777,#fff,#777)";
    else if(col==="rosegold")d.style.background="linear-gradient(135deg,#8b5a5a,#f3c1c1,#8b5a5a)";
    else d.style.background=col;
    d.onclick=()=>{saveState();selected.color=col;c.style.display="none";draw();}
    c.appendChild(d);
  });
  c.style.display=c.style.display==="block"?"none":"block";
}

function toggleCanvasPalette(){
  const p=document.getElementById("canvasPalette");
  p.innerHTML="";
  CANVAS_BACKGROUNDS.forEach(c=>{
    const d=document.createElement("div");
    d.className="thumb";
    d.style.background=c;
    d.onclick=()=>{saveState();canvasBg=c;p.style.display="none";draw();}
    p.appendChild(d);
  });
  p.style.display=p.style.display==="block"?"none":"block";
}

function saveImage(){
  const a=document.createElement("a");
  a.download="design.jpg";
  a.href=canvas.toDataURL("image/jpeg",1);
  a.click();
}

resizeCanvas();
draw();
</script>

</body>
</html>